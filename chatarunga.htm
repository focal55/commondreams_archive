<html>
<head>
<title>Untitled Document</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF" text="#000000">#!/usr/local/bin/perl



my $LINK = 'Yes';

print "Content-type: text/html\n\n";

&parseForm;

open(HEADER,"printnewsheader.html") ;
my @HEADER = <HEADER>;
close(HEADER);
#print it! Put a # before print if you don't want a header printed...
print "@HEADER";

my $data_file = "/data/httpd/vhosts/commondreams.org/httpdocs/scriptfiles/$FORM{file}";

if (!open(FILE,"$data_file")) { die "Can't open";}
my @FILE = <FILE>;
close(FILE);

$print = 1 ;

foreach $line(@FILE) {
        if ($LINK eq 'Yes') {
		if ($line =~ s/<A[^>]*>//gi) {
		}
		}
        if ($line =~ /beginimage/) {
                print $line ;
                $print = 0;
                next ;
        }

        if ($line =~ /endimage/) { $print = 1 ; }

        if ($print eq "1") {
                print $line;
        }

}

open(FOOTER,"printnewsfooter.html") ;
my @FOOTER = <FOOTER>;
close(FOOTER);
#print it! Put a # before print if you don't want a footer printed...
print "@FOOTER";
########################################################

sub parseForm {

    if ($ENV{'REQUEST_METHOD'} eq 'GET') {
        # Split the name-value pairs
        @pairs = split(/&/, $ENV{'QUERY_STRING'});
    }
elsif ($ENV{'REQUEST_METHOD'} eq 'POST') {


 read(STDIN, $buffer, $ENV{'CONTENT_LENGTH'});

   # Split the name-value pairs
   @pairs = split(/&/, $buffer);
}
   foreach $pair (@pairs) {
      ($name, $value) = split(/=/, $pair);

      # Un-Webify plus signs and %-encoding
      $value =~ tr/+/ /;
      $value =~ s/%([a-fA-F0-9][a-fA-F0-9])/pack("C", hex($1))/eg;

      $FORM{$name} = $value;
      }

}



</body>
</html>
